<!DOCTYPE html>
<html lang="en-us" dir="ltr">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="description" content="
  Setting up twitter(x) login with NextAuth &#43; Neon database storage with Vercel &#43; a small message widget
  #


  Setting up NextAuth
  #

To implement NextAuth on your website, first install Next-Auth
npm install next-auth
&mdash; Error message START, move to error message troubleshooting if encountered &mdash;
If you&rsquo;re having problems here, it might be because your ICU4C library is outdated.
What is ICU (bonus info)
To fix this, reinstall ICU">
<meta name="theme-color" media="(prefers-color-scheme: light)" content="#ffffff">
<meta name="theme-color" media="(prefers-color-scheme: dark)" content="#343a40">
<meta name="color-scheme" content="light dark"><meta property="og:url" content="blog.tormod.dev/twitter-neon-setup/">
  <meta property="og:site_name" content="Tormod&#39;s blog">
  <meta property="og:title" content="Setting up twitter(x) login with NextAuth &#43; neon database storage with Vercel">
  <meta property="og:description" content="Setting up twitter(x) login with NextAuth &#43; Neon database storage with Vercel &#43; a small message widget # Setting up NextAuth # To implement NextAuth on your website, first install Next-Auth
npm install next-auth — Error message START, move to error message troubleshooting if encountered — If you’re having problems here, it might be because your ICU4C library is outdated. What is ICU (bonus info)
To fix this, reinstall ICU">
  <meta property="og:locale" content="en_us">
  <meta property="og:type" content="article">
    <meta property="article:published_time" content="2024-11-18T10:58:08+10:00">
    <meta property="article:modified_time" content="2024-11-18T10:58:08+10:00">
<title>Setting up twitter(x) login with NextAuth &#43; neon database storage with Vercel | Tormod&#39;s blog</title>
<link rel="icon" href="/blog.tormod.dev/favicon.png" >
<link rel="manifest" href="blog.tormod.dev/manifest.json">
<link rel="canonical" href="blog.tormod.dev/twitter-neon-setup/">
<link rel="stylesheet" href="blog.tormod.dev/book.min.6c8b9d2a1fc95075ed7da46ca81060b39add8fff6741ac51259f768929281e2c.css" >
  <script defer src="/blog.tormod.dev/fuse.min.js"></script>
  <script defer src="blog.tormod.dev/en.search.min.6274f46c307a83d98ccc3fce5e29dc346f4c88fc1fdb1b8cedcc6e89b187ddee.js" ></script>
<!--
Made with Book Theme
https://github.com/alex-shpak/hugo-book
-->
  
</head>
<body dir="ltr">
  <input type="checkbox" class="hidden toggle" id="menu-control" />
  <input type="checkbox" class="hidden toggle" id="toc-control" />
  <main class="container flex">
    <aside class="book-menu">
      <div class="book-menu-content">
        
  <nav>
<h2 class="book-brand">
  <a class="flex align-center" href="blog.tormod.dev/"><span>Tormod&#39;s blog</span>
  </a>
</h2>


<div class="book-search hidden">
  <input type="text" id="book-search-input" placeholder="Search" aria-label="Search" maxlength="64" data-hotkeys="s/" />
  <div class="book-search-spinner hidden"></div>
  <ul id="book-search-results"></ul>
</div>
<script>document.querySelector(".book-search").classList.remove("hidden")</script>













  



  
  <ul>
    
      
        <li>
          
  
  

  
    <a href="blog.tormod.dev/database-operations/" class="">Database operations</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="blog.tormod.dev/how-to-set-up-git-and-github/" class="">How to set up Git and Github</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="blog.tormod.dev/twitter-neon-setup/" class="active">Setting up twitter(x) login with NextAuth &#43; neon database storage with Vercel</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="blog.tormod.dev/what-is-icu/" class="">What is ICU?</a>
  

        </li>
      
    
  </ul>














</nav>




  <script>(function(){var e=document.querySelector("aside .book-menu-content");addEventListener("beforeunload",function(){localStorage.setItem("menu.scrollTop",e.scrollTop)}),e.scrollTop=localStorage.getItem("menu.scrollTop")})()</script>


 
      </div>
    </aside>

    <div class="book-page">
      <header class="book-header">
        
  <div class="flex align-center justify-between">
  <label for="menu-control">
    <img src="/blog.tormod.dev/svg/menu.svg" class="book-icon" alt="Menu" />
  </label>

  <h3>Setting up twitter(x) login with NextAuth &#43; neon database storage with Vercel</h3>

  <label for="toc-control">
    
    <img src="/blog.tormod.dev/svg/toc.svg" class="book-icon" alt="Table of Contents" />
    
  </label>
</div>


  
  <aside class="hidden clearfix">
    
  
<nav id="TableOfContents">
  <ul>
    <li><a href="#setting-up-nextauth">Setting up NextAuth</a></li>
    <li><a href="#setting-up-twitter-authentication">Setting up Twitter authentication</a>
      <ul>
        <li><a href="#set-up-a-neon-database-with-vercel">Set up a Neon Database with Vercel</a></li>
        <li><a href="#set-up-twitter-authentication-types">Set up Twitter Authentication Types</a></li>
        <li><a href="#configure-nextauth-with-twitter-provider">Configure NextAuth with Twitter Provider</a></li>
        <li><a href="#create-database-operations">Create database operations</a></li>
        <li><a href="#optional-create-a-message-list-component-for-your-users-to-write-messages">Optional: Create a message list component for your users to write messages</a></li>
        <li><a href="#put-it-all-together-on-the-main-page">Put it all together on the main page</a></li>
        <li><a href="#make-sure-your-envlocal-file-is-complete">Make sure your .env.local file is complete</a></li>
      </ul>
    </li>
  </ul>
</nav>



  </aside>
  
 
      </header>

      
      
  <article class="markdown book-article"><h1 id="setting-up-twitterx-login-with-nextauth--neon-database-storage-with-vercel--a-small-message-widget">
  Setting up twitter(x) login with NextAuth + Neon database storage with Vercel + a small message widget
  <a class="anchor" href="#setting-up-twitterx-login-with-nextauth--neon-database-storage-with-vercel--a-small-message-widget">#</a>
</h1>
<h2 id="setting-up-nextauth">
  Setting up NextAuth
  <a class="anchor" href="#setting-up-nextauth">#</a>
</h2>
<p>To implement NextAuth on your website, first install Next-Auth</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>npm install next-auth
</span></span></code></pre></div><p><strong>&mdash; Error message START, move to error message troubleshooting if encountered &mdash;</strong>
If you&rsquo;re having problems here, it might be because your ICU4C library is outdated.
<a href="/what-is-icu">What is ICU</a> (bonus info)</p>
<p>To fix this, reinstall ICU</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>brew reinstall icu4c
</span></span></code></pre></div><p>Link it</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>brew link icu4c --force
</span></span></code></pre></div><p><strong>&mdash; Error message END &mdash;</strong></p>
<p>Once you have installed Next-Auth, create a .env.local file in your project&rsquo;s root.</p>
<p>In project root, set up a secret token for NextAuth</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>npx auth secret
</span></span></code></pre></div><p>This will put a NEXT_SECRET variable in your .env.local file.
Add a NEXT_URL=&ldquo;http://localhost:3000&rdquo; variable.</p>
<ul>
<li>In vercel put in your site where you will implement authentication.</li>
</ul>
<p>In your project, create the folders</p>
<ul>
<li>app/api/auth/[&hellip;nextauth]
<ul>
<li>[&hellip;nextauth] is a catch-all dynamic route that handles any sub-routes under auth that processes requests for nextauth.js.
<ul>
<li>Signing in users</li>
<li>Signing out users</li>
<li>Handling OAuth callbacks</li>
<li>Refreshing tokens</li>
<li>Accessing user session information</li>
</ul>
</li>
</ul>
</li>
</ul>
<h2 id="setting-up-twitter-authentication">
  Setting up Twitter authentication
  <a class="anchor" href="#setting-up-twitter-authentication">#</a>
</h2>
<ul>
<li>Create a Twitter Developer Account</li>
<li>Create a project, making sure to set the following settings:
<ul>
<li>App permissions:
<ul>
<li>Read and write</li>
<li>Don&rsquo;t request email from users</li>
</ul>
</li>
<li>Type of App:
<ul>
<li>Web App, Automated App or Bot</li>
</ul>
</li>
<li>App info:
<ul>
<li>Callback url
<ul>
<li>http://localhost:3000/api/auth/callback/twitter</li>
<li>any live site you want it on, ex. <a href="https://yoursite.com/api/auth/callback/twitter">https://yoursite.com/api/auth/callback/twitter</a></li>
</ul>
</li>
<li>Website url
<ul>
<li>Some site to identify you</li>
</ul>
</li>
<li>ToS
<ul>
<li>If you want / if you collect user data</li>
</ul>
</li>
<li>Privacy policy
<ul>
<li>If you want / If you collect user data
Congrats, you now have API keys!
Take note of the Client ID and Secret. You will need these.</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
<h3 id="set-up-a-neon-database-with-vercel">
  Set up a Neon Database with Vercel
  <a class="anchor" href="#set-up-a-neon-database-with-vercel">#</a>
</h3>
<p>On your Vercel project, go to storage and set up a free Neon database. Access the Neon console linked in your vercel project and go to the SQL Editor.</p>
<p>Create a table in your neon database by typing the below and running the code:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sql" data-lang="sql"><span style="display:flex;"><span><span style="color:#66d9ef">CREATE</span> <span style="color:#66d9ef">TABLE</span> comments (
</span></span><span style="display:flex;"><span>  id SERIAL <span style="color:#66d9ef">PRIMARY</span> <span style="color:#66d9ef">KEY</span>,
</span></span><span style="display:flex;"><span>  content TEXT <span style="color:#66d9ef">NOT</span> <span style="color:#66d9ef">NULL</span>,
</span></span><span style="display:flex;"><span>  username TEXT <span style="color:#66d9ef">NOT</span> <span style="color:#66d9ef">NULL</span>,
</span></span><span style="display:flex;"><span>  created_at <span style="color:#66d9ef">TIMESTAMP</span> <span style="color:#66d9ef">WITH</span> TIME <span style="color:#66d9ef">ZONE</span> <span style="color:#66d9ef">DEFAULT</span> <span style="color:#66d9ef">CURRENT_TIMESTAMP</span>
</span></span><span style="display:flex;"><span>);
</span></span></code></pre></div><p>This will create a table called comments that will store the comment id, the content of any messages written included, the username and the time it was created.</p>
<h3 id="set-up-twitter-authentication-types">
  Set up Twitter Authentication Types
  <a class="anchor" href="#set-up-twitter-authentication-types">#</a>
</h3>
<p>Define the Twitter profile structure
Create a file called types.ts – this file will contain undefined types to satisfy typescript</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-ts" data-lang="ts"><span style="display:flex;"><span><span style="color:#66d9ef">export</span> <span style="color:#66d9ef">interface</span> <span style="color:#a6e22e">TwitterProfile</span> {
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">data</span><span style="color:#f92672">:</span> {
</span></span><span style="display:flex;"><span>      <span style="color:#a6e22e">id</span>: <span style="color:#66d9ef">string</span>;
</span></span><span style="display:flex;"><span>      <span style="color:#a6e22e">name</span>: <span style="color:#66d9ef">string</span>;
</span></span><span style="display:flex;"><span>      <span style="color:#a6e22e">username</span>: <span style="color:#66d9ef">string</span>;
</span></span><span style="display:flex;"><span>      <span style="color:#75715e">// add any more here
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    };
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><h3 id="configure-nextauth-with-twitter-provider">
  Configure NextAuth with Twitter Provider
  <a class="anchor" href="#configure-nextauth-with-twitter-provider">#</a>
</h3>
<p>Create the authentification configuration</p>
<p>in app/api/[&hellip;nextauth]/route.ts:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-ts" data-lang="ts"><span style="display:flex;"><span><span style="color:#66d9ef">import</span> <span style="color:#a6e22e">NextAuth</span>, { <span style="color:#66d9ef">type</span> <span style="color:#a6e22e">NextAuthOptions</span> } <span style="color:#66d9ef">from</span> <span style="color:#e6db74">&#34;next-auth&#34;</span>;
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">import</span> <span style="color:#a6e22e">TwitterProvider</span> <span style="color:#66d9ef">from</span> <span style="color:#e6db74">&#34;next-auth/providers/twitter&#34;</span>;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">import</span> { <span style="color:#a6e22e">TwitterProfile</span> } <span style="color:#66d9ef">from</span> <span style="color:#e6db74">&#34;@/app/types/types&#34;</span>;
</span></span><span style="display:flex;"><span><span style="color:#75715e">// replace with wherever you put your types.ts file
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">// 1. Extend NextAuth session to include Twitter username (and other)
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#66d9ef">declare</span> <span style="color:#a6e22e">module</span> <span style="color:#e6db74">&#34;next-auth&#34;</span> {
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">interface</span> <span style="color:#a6e22e">Session</span> {
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">user</span><span style="color:#f92672">:</span> {
</span></span><span style="display:flex;"><span>            <span style="color:#a6e22e">username?</span>: <span style="color:#66d9ef">string</span>;
</span></span><span style="display:flex;"><span>            <span style="color:#a6e22e">name?</span>: <span style="color:#66d9ef">string</span> <span style="color:#f92672">|</span> <span style="color:#66d9ef">null</span>;
</span></span><span style="display:flex;"><span>            <span style="color:#a6e22e">email?</span>: <span style="color:#66d9ef">string</span> <span style="color:#f92672">|</span> <span style="color:#66d9ef">null</span>;
</span></span><span style="display:flex;"><span>            <span style="color:#a6e22e">image?</span>: <span style="color:#66d9ef">string</span> <span style="color:#f92672">|</span> <span style="color:#66d9ef">null</span>;
</span></span><span style="display:flex;"><span>            <span style="color:#75715e">// any other
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>        };
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">// 2. Set up Twitter Provider
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#66d9ef">const</span> <span style="color:#a6e22e">authOptions</span>: <span style="color:#66d9ef">NextAuthOptions</span> <span style="color:#f92672">=</span> {
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">providers</span><span style="color:#f92672">:</span> [
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">TwitterProvider</span>({
</span></span><span style="display:flex;"><span>            <span style="color:#a6e22e">clientId</span>: <span style="color:#66d9ef">process.env.TWITTER_CLIENT_ID</span> <span style="color:#66d9ef">as</span> <span style="color:#66d9ef">string</span>,
</span></span><span style="display:flex;"><span>            <span style="color:#a6e22e">clientSecret</span>: <span style="color:#66d9ef">process.env.TWITTER_CLIENT_SECRET</span> <span style="color:#66d9ef">as</span> <span style="color:#66d9ef">string</span>,
</span></span><span style="display:flex;"><span>            <span style="color:#a6e22e">version</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#34;2.0&#34;</span>,
</span></span><span style="display:flex;"><span>            <span style="color:#75715e">// make sure you have configured your twitter dev project to be 2.0
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>            <span style="color:#a6e22e">authorization</span><span style="color:#f92672">:</span> {
</span></span><span style="display:flex;"><span>                <span style="color:#a6e22e">params</span><span style="color:#f92672">:</span> {
</span></span><span style="display:flex;"><span>                    <span style="color:#a6e22e">scope</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#34;users.read tweet.read offline.access&#34;</span>,
</span></span><span style="display:flex;"><span>                }
</span></span><span style="display:flex;"><span>            }
</span></span><span style="display:flex;"><span>        }),
</span></span><span style="display:flex;"><span>    ],
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">callbacks</span><span style="color:#f92672">:</span> {
</span></span><span style="display:flex;"><span>        <span style="color:#75715e">// 3. Capture username during JWT creation
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>        <span style="color:#66d9ef">async</span> <span style="color:#a6e22e">jwt</span>({ <span style="color:#a6e22e">token</span>, <span style="color:#a6e22e">profile</span> }) {
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">if</span> (<span style="color:#a6e22e">profile</span>) {
</span></span><span style="display:flex;"><span>                <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">twitterProfile</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">profile</span> <span style="color:#66d9ef">as</span> <span style="color:#a6e22e">TwitterProfile</span>;
</span></span><span style="display:flex;"><span>                <span style="color:#a6e22e">token</span>.<span style="color:#a6e22e">username</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">twitterProfile</span>.<span style="color:#a6e22e">data</span>.<span style="color:#a6e22e">username</span>;
</span></span><span style="display:flex;"><span>            }
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">return</span> <span style="color:#a6e22e">token</span>;
</span></span><span style="display:flex;"><span>        },
</span></span><span style="display:flex;"><span>        <span style="color:#75715e">// 4. Add username to session
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>        <span style="color:#66d9ef">async</span> <span style="color:#a6e22e">session</span>({ <span style="color:#a6e22e">session</span>, <span style="color:#a6e22e">token</span> }) {
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">if</span> (<span style="color:#a6e22e">session</span>.<span style="color:#a6e22e">user</span>) {
</span></span><span style="display:flex;"><span>                <span style="color:#a6e22e">session</span>.<span style="color:#a6e22e">user</span>.<span style="color:#a6e22e">username</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">token</span>.<span style="color:#a6e22e">username</span> <span style="color:#66d9ef">as</span> <span style="color:#66d9ef">string</span>;
</span></span><span style="display:flex;"><span>            }
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">return</span> <span style="color:#a6e22e">session</span>;
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>};
</span></span></code></pre></div><h3 id="create-database-operations">
  Create database operations
  <a class="anchor" href="#create-database-operations">#</a>
</h3>
<p>Create an actions.ts file to do database operations. I have added some optional comment features but you can do any other database actions using similar functions.
<a href="/database-operations">Database operations</a> (bonus info)(<em>coming soon</em>)</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-ts" data-lang="ts"><span style="display:flex;"><span><span style="color:#e6db74">&#39;use server&#39;</span>;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">export</span> <span style="color:#66d9ef">async</span> <span style="color:#66d9ef">function</span> <span style="color:#a6e22e">createComment</span>(<span style="color:#a6e22e">comment</span>: <span style="color:#66d9ef">string</span>, <span style="color:#a6e22e">twitterHandle</span>: <span style="color:#66d9ef">string</span>) {
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">try</span> {
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">sql</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">neon</span>(<span style="color:#a6e22e">process</span>.<span style="color:#a6e22e">env</span>.<span style="color:#a6e22e">DATABASE_URL</span><span style="color:#f92672">!</span>);
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">result</span> <span style="color:#f92672">=</span> <span style="color:#66d9ef">await</span> <span style="color:#a6e22e">sql</span><span style="color:#e6db74">`
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">      INSERT INTO comments (content, username, created_at) 
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">      VALUES (</span><span style="color:#e6db74">${</span><span style="color:#a6e22e">comment</span><span style="color:#e6db74">}</span><span style="color:#e6db74">, </span><span style="color:#e6db74">${</span><span style="color:#a6e22e">twitterHandle</span><span style="color:#e6db74">}</span><span style="color:#e6db74">, NOW())
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">      RETURNING *
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    `</span>;
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">return</span> { 
</span></span><span style="display:flex;"><span>      <span style="color:#a6e22e">success</span>: <span style="color:#66d9ef">true</span>, 
</span></span><span style="display:flex;"><span>      <span style="color:#a6e22e">data</span><span style="color:#f92672">:</span> {
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">text</span>: <span style="color:#66d9ef">result</span>[<span style="color:#ae81ff">0</span>].<span style="color:#a6e22e">content</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">username</span>: <span style="color:#66d9ef">result</span>[<span style="color:#ae81ff">0</span>].<span style="color:#a6e22e">username</span>
</span></span><span style="display:flex;"><span>      }
</span></span><span style="display:flex;"><span>    };
</span></span><span style="display:flex;"><span>  } <span style="color:#66d9ef">catch</span> (<span style="color:#a6e22e">error</span>) {
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">return</span> { <span style="color:#a6e22e">success</span>: <span style="color:#66d9ef">false</span>, <span style="color:#a6e22e">error</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#39;Failed to create comment&#39;</span> };
</span></span><span style="display:flex;"><span>  }
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">export</span> <span style="color:#66d9ef">async</span> <span style="color:#66d9ef">function</span> <span style="color:#a6e22e">getMessages() {</span>
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">sql</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">neon</span>(<span style="color:#a6e22e">process</span>.<span style="color:#a6e22e">env</span>.<span style="color:#a6e22e">DATABASE_URL</span><span style="color:#f92672">!</span>);
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">messages</span> <span style="color:#f92672">=</span> <span style="color:#66d9ef">await</span> <span style="color:#a6e22e">sql</span><span style="color:#e6db74">`
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    SELECT content, username FROM comments
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    ORDER BY created_at DESC
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">  `</span>;
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">return</span> <span style="color:#a6e22e">messages</span>.<span style="color:#a6e22e">map</span>(<span style="color:#a6e22e">msg</span> <span style="color:#f92672">=&gt;</span> ({
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">text</span>: <span style="color:#66d9ef">msg.content</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">username</span>: <span style="color:#66d9ef">msg.username</span>
</span></span><span style="display:flex;"><span>  }));
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><h3 id="optional-create-a-message-list-component-for-your-users-to-write-messages">
  Optional: Create a message list component for your users to write messages
  <a class="anchor" href="#optional-create-a-message-list-component-for-your-users-to-write-messages">#</a>
</h3>
<p>Create a MessageList.tsx file in /components/</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-tsx" data-lang="tsx"><span style="display:flex;"><span><span style="color:#66d9ef">export</span> <span style="color:#66d9ef">default</span> <span style="color:#66d9ef">function</span> <span style="color:#a6e22e">MessageList</span>({ <span style="color:#a6e22e">messages</span> }<span style="color:#f92672">:</span> <span style="color:#a6e22e">MessageListProps</span>) {
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">return</span> (
</span></span><span style="display:flex;"><span>    &lt;<span style="color:#f92672">div</span> <span style="color:#a6e22e">className</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;grid grid-cols-3 gap-4&#34;</span>&gt;
</span></span><span style="display:flex;"><span>      {[...<span style="color:#a6e22e">messages</span>].<span style="color:#a6e22e">map</span>((<span style="color:#a6e22e">message</span>, <span style="color:#a6e22e">index</span>) <span style="color:#f92672">=&gt;</span> (
</span></span><span style="display:flex;"><span>        &lt;<span style="color:#f92672">div</span> <span style="color:#a6e22e">key</span><span style="color:#f92672">=</span>{<span style="color:#a6e22e">index</span>} <span style="color:#a6e22e">className</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;p-4 border rounded-lg shadow-sm&#34;</span>&gt;
</span></span><span style="display:flex;"><span>          &lt;<span style="color:#f92672">p</span> <span style="color:#a6e22e">className</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;break-words mb-2&#34;</span>&gt;{<span style="color:#a6e22e">message</span>.<span style="color:#a6e22e">text</span>}&lt;/<span style="color:#f92672">p</span>&gt;
</span></span><span style="display:flex;"><span>          &lt;<span style="color:#f92672">a</span> <span style="color:#a6e22e">href</span><span style="color:#f92672">=</span>{<span style="color:#e6db74">`https://x.com/</span><span style="color:#e6db74">${</span><span style="color:#a6e22e">message</span>.<span style="color:#a6e22e">username</span><span style="color:#e6db74">}</span><span style="color:#e6db74">`</span>}&gt;
</span></span><span style="display:flex;"><span>            <span style="color:#960050;background-color:#1e0010">@</span>{<span style="color:#a6e22e">message</span>.<span style="color:#a6e22e">username</span>}
</span></span><span style="display:flex;"><span>          &lt;/<span style="color:#f92672">a</span>&gt;
</span></span><span style="display:flex;"><span>        &lt;/<span style="color:#f92672">div</span>&gt;
</span></span><span style="display:flex;"><span>      ))}
</span></span><span style="display:flex;"><span>    &lt;/<span style="color:#f92672">div</span>&gt;
</span></span><span style="display:flex;"><span>  );
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><h3 id="put-it-all-together-on-the-main-page">
  Put it all together on the main page
  <a class="anchor" href="#put-it-all-together-on-the-main-page">#</a>
</h3>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-tsx" data-lang="tsx"><span style="display:flex;"><span><span style="color:#66d9ef">export</span> <span style="color:#66d9ef">default</span> <span style="color:#66d9ef">function</span> <span style="color:#a6e22e">Home() {</span>
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">const</span> { <span style="color:#a6e22e">data</span>: <span style="color:#66d9ef">session</span>, <span style="color:#a6e22e">status</span> } <span style="color:#f92672">=</span> <span style="color:#a6e22e">useSession</span>();
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">const</span> [<span style="color:#a6e22e">messages</span>, <span style="color:#a6e22e">setMessages</span>] <span style="color:#f92672">=</span> <span style="color:#a6e22e">useState</span><span style="color:#f92672">&lt;</span>{ <span style="color:#a6e22e">text</span>: <span style="color:#66d9ef">string</span>, <span style="color:#a6e22e">username</span>: <span style="color:#66d9ef">string</span> }[]<span style="color:#f92672">&gt;</span>([]);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  <span style="color:#75715e">// Load messages on component mount
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>  <span style="color:#a6e22e">useEffect</span>(() <span style="color:#f92672">=&gt;</span> {
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">async</span> <span style="color:#66d9ef">function</span> <span style="color:#a6e22e">fetchMessages() {</span>
</span></span><span style="display:flex;"><span>      <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">fetchedMessages</span> <span style="color:#f92672">=</span> <span style="color:#66d9ef">await</span> <span style="color:#a6e22e">getMessages</span>();
</span></span><span style="display:flex;"><span>      <span style="color:#a6e22e">setMessages</span>(<span style="color:#a6e22e">fetchedMessages</span>);
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">fetchMessages</span>();
</span></span><span style="display:flex;"><span>  }, []);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  <span style="color:#75715e">// Handle message creation
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>  <span style="color:#66d9ef">async</span> <span style="color:#66d9ef">function</span> <span style="color:#a6e22e">create</span>(<span style="color:#a6e22e">formData</span>: <span style="color:#66d9ef">FormData</span>) {
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">comment</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">formData</span>.<span style="color:#66d9ef">get</span>(<span style="color:#e6db74">&#39;comment&#39;</span>) <span style="color:#66d9ef">as</span> <span style="color:#66d9ef">string</span>;
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">if</span> (<span style="color:#f92672">!</span><span style="color:#a6e22e">comment</span><span style="color:#f92672">?</span>.<span style="color:#a6e22e">trim</span>()) <span style="color:#66d9ef">return</span>;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">result</span> <span style="color:#f92672">=</span> <span style="color:#66d9ef">await</span> <span style="color:#a6e22e">createComment</span>(<span style="color:#a6e22e">comment</span>, <span style="color:#a6e22e">session</span><span style="color:#f92672">?</span>.<span style="color:#a6e22e">user</span><span style="color:#f92672">?</span>.<span style="color:#a6e22e">username</span> <span style="color:#f92672">||</span> <span style="color:#e6db74">&#39;anonymous&#39;</span>);
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">if</span> (<span style="color:#a6e22e">result</span>.<span style="color:#a6e22e">success</span>) {
</span></span><span style="display:flex;"><span>      <span style="color:#a6e22e">setMessages</span>(<span style="color:#a6e22e">prev</span> <span style="color:#f92672">=&gt;</span> [<span style="color:#a6e22e">result</span>.<span style="color:#a6e22e">data</span>, ...<span style="color:#a6e22e">prev</span>]);
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>  }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">return</span> (
</span></span><span style="display:flex;"><span>    &lt;<span style="color:#f92672">div</span>&gt;
</span></span><span style="display:flex;"><span>      {<span style="color:#a6e22e">session</span> <span style="color:#f92672">?</span> (
</span></span><span style="display:flex;"><span>        &lt;&gt;
</span></span><span style="display:flex;"><span>          &lt;<span style="color:#f92672">h2</span>&gt;<span style="color:#a6e22e">Welcome</span>, {<span style="color:#a6e22e">session</span>.<span style="color:#a6e22e">user</span>.<span style="color:#a6e22e">username</span>}<span style="color:#f92672">!</span>&lt;/<span style="color:#f92672">h2</span>&gt;
</span></span><span style="display:flex;"><span>          &lt;<span style="color:#f92672">form</span> <span style="color:#a6e22e">onSubmit</span><span style="color:#f92672">=</span>{(<span style="color:#a6e22e">e</span>) <span style="color:#f92672">=&gt;</span> {
</span></span><span style="display:flex;"><span>            <span style="color:#a6e22e">e</span>.<span style="color:#a6e22e">preventDefault</span>();
</span></span><span style="display:flex;"><span>            <span style="color:#a6e22e">create</span>(<span style="color:#66d9ef">new</span> <span style="color:#a6e22e">FormData</span>(<span style="color:#a6e22e">e</span>.<span style="color:#a6e22e">currentTarget</span>));
</span></span><span style="display:flex;"><span>          }}&gt;
</span></span><span style="display:flex;"><span>            &lt;<span style="color:#f92672">input</span> <span style="color:#a6e22e">type</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;text&#34;</span> <span style="color:#a6e22e">name</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;comment&#34;</span> <span style="color:#a6e22e">placeholder</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;Write a message&#34;</span> /&gt;
</span></span><span style="display:flex;"><span>            &lt;<span style="color:#f92672">button</span> <span style="color:#a6e22e">type</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;submit&#34;</span>&gt;<span style="color:#a6e22e">Submit</span>&lt;/<span style="color:#f92672">button</span>&gt;
</span></span><span style="display:flex;"><span>          &lt;/<span style="color:#f92672">form</span>&gt;
</span></span><span style="display:flex;"><span>        &lt;/&gt;
</span></span><span style="display:flex;"><span>      ) <span style="color:#f92672">:</span> (
</span></span><span style="display:flex;"><span>        &lt;<span style="color:#f92672">button</span> <span style="color:#a6e22e">onClick</span><span style="color:#f92672">=</span>{() <span style="color:#f92672">=&gt;</span> <span style="color:#a6e22e">signIn</span>(<span style="color:#e6db74">&#39;twitter&#39;</span>)}&gt;
</span></span><span style="display:flex;"><span>          <span style="color:#a6e22e">Sign</span> <span style="color:#66d9ef">in</span> <span style="color:#66d9ef">with</span> <span style="color:#a6e22e">Twitter</span>
</span></span><span style="display:flex;"><span>        &lt;/<span style="color:#f92672">button</span>&gt;
</span></span><span style="display:flex;"><span>      )}
</span></span><span style="display:flex;"><span>      &lt;<span style="color:#f92672">MessageList</span> <span style="color:#a6e22e">messages</span><span style="color:#f92672">=</span>{<span style="color:#a6e22e">messages</span>} /&gt;
</span></span><span style="display:flex;"><span>    &lt;/<span style="color:#f92672">div</span>&gt;
</span></span><span style="display:flex;"><span>  );
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><h3 id="make-sure-your-envlocal-file-is-complete">
  Make sure your .env.local file is complete
  <a class="anchor" href="#make-sure-your-envlocal-file-is-complete">#</a>
</h3>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-env" data-lang="env"><span style="display:flex;"><span>TWITTER_CLIENT_ID<span style="color:#f92672">=</span>your_twitter_client_id
</span></span><span style="display:flex;"><span>TWITTER_CLIENT_SECRET<span style="color:#f92672">=</span>your_twitter_client_secret
</span></span><span style="display:flex;"><span>DATABASE_URL<span style="color:#f92672">=</span>your_neon_database_url
</span></span><span style="display:flex;"><span>NEXTAUTH_SECRET<span style="color:#f92672">=</span>your_nextauth_secret
</span></span><span style="display:flex;"><span>NEXTAUTH_URL<span style="color:#f92672">=</span>http://localhost:3000
</span></span></code></pre></div><p>remember that this file only stores the environment variables locally, and you should put the variables in your hosted environment when you launch.</p>
<p>Now you should be able to test locally and launch globally (on the world wide www&rsquo;s) your twitter authentication, with some database fun.</p>
</article>
 
      

      <footer class="book-footer">
        
  <div class="flex flex-wrap justify-between">





</div>



  <script>(function(){function e(e){const t=window.getSelection(),n=document.createRange();n.selectNodeContents(e),t.removeAllRanges(),t.addRange(n)}document.querySelectorAll("pre code").forEach(t=>{t.addEventListener("click",function(){if(window.getSelection().toString())return;e(t.parentElement),navigator.clipboard&&navigator.clipboard.writeText(t.parentElement.textContent)})})})()</script>


 
        <p><b>All articles</b></p>
        

  



  
  <ul>
    
      
        <li>
          
  
  

  
    <a href="blog.tormod.dev/database-operations/" class="">Database operations</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="blog.tormod.dev/how-to-set-up-git-and-github/" class="">How to set up Git and Github</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="blog.tormod.dev/twitter-neon-setup/" class="active">Setting up twitter(x) login with NextAuth &#43; neon database storage with Vercel</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="blog.tormod.dev/what-is-icu/" class="">What is ICU?</a>
  

        </li>
      
    
  </ul>







        
      </footer>

      
  
  <div class="book-comments">

</div>
  
 

      <label for="menu-control" class="hidden book-menu-overlay"></label>
    </div>

    
    <aside class="book-toc">
      <div class="book-toc-content">
        
  
<nav id="TableOfContents">
  <ul>
    <li><a href="#setting-up-nextauth">Setting up NextAuth</a></li>
    <li><a href="#setting-up-twitter-authentication">Setting up Twitter authentication</a>
      <ul>
        <li><a href="#set-up-a-neon-database-with-vercel">Set up a Neon Database with Vercel</a></li>
        <li><a href="#set-up-twitter-authentication-types">Set up Twitter Authentication Types</a></li>
        <li><a href="#configure-nextauth-with-twitter-provider">Configure NextAuth with Twitter Provider</a></li>
        <li><a href="#create-database-operations">Create database operations</a></li>
        <li><a href="#optional-create-a-message-list-component-for-your-users-to-write-messages">Optional: Create a message list component for your users to write messages</a></li>
        <li><a href="#put-it-all-together-on-the-main-page">Put it all together on the main page</a></li>
        <li><a href="#make-sure-your-envlocal-file-is-complete">Make sure your .env.local file is complete</a></li>
      </ul>
    </li>
  </ul>
</nav>


 
      </div>
    </aside>
    
  </main>

  
</body>
</html>












